$.extend($.ligerDefaults.Grid,{rowHeight:30,checkbox:true,fixedCellHeight:false,frozen:false,async:true,headerRowHeight:30,allowUnSelectRow:true,onError:function(c,a){}});$.extend($.ligerDefaults.Tab,{contextmenu:false});$.extend($.ligerui.controls.Grid.prototype,{_initBuildHeader:function(){var a=this,b=this.options;if(b.title){$(".l-panel-header-text",a.header).html(b.title);if(b.headerImg){a.header.append("<img src='"+b.headerImg+"' />").addClass("l-panel-header-hasicon");}}else{a.header.hide();}if(b.toolbar){if($.fn.ligerToolBar){a.toolbarManager=a.topbar.ligerToolBar(b.toolbar);}}else{a.topbar.remove();}},addEditRow:function(b){var a=this;b=a.add(b);return a.beginEdit(b);},getEditingRow:function(){var c=this;for(var b=0,a=c.rows.length;b<a;b++){if(c.rows[b]._editing){return c.rows[b];}}return null;},getChangedRows:function(){var c=this,b=[];a(c.getDeleted(),"delete");a(c.getUpdated(),"update");a(c.getAdded(),"add");return b;function a(g,e){if(!g||!g instanceof Array){return;}for(var f=0,d=g.length;f<d;f++){b.push($.extend({},g[f],{__status:e}));}}}});$.ligerDefaults.Grid.formatters["percent"]=function(c,b){if(c<0){c=0;}if(c>1){c=1;}var a=b.editor.precision||0;return(c*100).toFixed(a)+"%";};$.ligerDefaults.Grid.formatters["numberbox"]=function(c,b){var a=b.editor.precision||0;return c.toFixed(a);};$.ligerDefaults.Grid.formatters["currency"]=function(a,c){if(!a){return"0.00";}a=a.toString().replace(/\$|\,/g,"");if(isNaN(a)){a="0.00";}sign=(a==(a=Math.abs(a)));a=Math.floor(a*100+0.50000000001);cents=a%100;a=Math.floor(a/100).toString();if(cents<10){cents="0"+cents;}for(var b=0;b<Math.floor((a.length-(1+b))/3);b++){a=a.substring(0,a.length-(4*b+3))+","+a.substring(a.length-(4*b+3));}return""+(((sign)?"":"-")+""+a+"."+cents);};$.ligerDefaults.Grid.editors["percent"]={create:function(b,e){var d=e.column;var a=d.editor.precision||0;var c=$("<input type='text' style='text-align:right' class='l-text' />");c.bind("keypress",function(g){var f=window.event?g.keyCode:g.which;return f>=48&&f<=57||f==46||f==8;});c.bind("blur",function(){var f=c.val();f.replace("%","");c.val(parseFloat(f).toFixed(a));});b.append(c);return c;},getValue:function(a,d){var c=a.val();c.replace("%","");var b=parseFloat(c)*0.01;if(b<0){b=0;}if(b>1){b=1;}return b;},setValue:function(b,d,f){var c=f.column;var a=c.editor.precision||0;if(d<0){d=0;}if(d>1){d=1;}var e=(d*100).toFixed(a)+"%";b.val(e);},resize:function(b,c,a,d){b.width(c).height(a);}};$.ligerDefaults.Grid.editors["numberbox"]={create:function(b,e){var d=e.column;var a=d.editor.precision;var c=$("<input type='text' style='text-align:right' class='l-text' />");c.bind("keypress",function(g){var f=window.event?g.keyCode:g.which;return f>=48&&f<=57||f==46||f==8;});c.bind("blur",function(){var f=c.val();c.val(parseFloat(f).toFixed(a));});b.append(c);return c;},getValue:function(a,b){return parseFloat(a.val());},setValue:function(b,d,e){var c=e.column;var a=c.editor.precision;b.val(d.toFixed(a));},resize:function(b,c,a,d){b.width(c).height(a);}};$.ligerDefaults.Grid.editors["date"]={create:function(a,g){var f=g.column;var b=$("<input type='text'/>");a.append(b);var c={};var e=f.editor.p||f.editor.ext;if(e){var d=typeof(e)=="function"?e(g.record,g.rowindex,g.value,f):e;$.extend(c,d);}b.ligerDateEditor(c);return b;},getValue:function(a,b){return a.liger("option","value");},setValue:function(a,b,c){a.liger("option","value",b);},resize:function(b,c,a,d){b.liger("option","width",c);b.liger("option","height",a);},destroy:function(a,b){a.liger("destroy");}};$.ligerDefaults.Grid.editors["select"]=$.ligerDefaults.Grid.editors["combobox"]={create:function(a,h,g){var f=h.column;var b=$("<input type='text'/>");a.append(b);var c={data:f.editor.data,slide:false,valueField:f.editor.valueField||f.editor.valueColumnName,textField:f.editor.textField||f.editor.displayColumnName,selectBoxWidth:false};if(g){c.selectBoxWidth=g;}var e=f.editor.p||f.editor.ext;if(e){var d=typeof(e)=="function"?e(h.record,h.rowindex,h.value,f):e;$.extend(c,d);}b.ligerComboBox(c);return b;},getValue:function(a,b){return a.liger("option","value");},setValue:function(a,b,c){a.liger("option","value",b);},resize:function(b,c,a,d){b.liger("option","width",c-1);b.liger("option","height",a-2);},destroy:function(a,b){a.liger("destroy");}};$.ligerDefaults.Grid.editors["int"]=$.ligerDefaults.Grid.editors["float"]=$.ligerDefaults.Grid.editors["spinner"]={create:function(a,e){var d=e.column;var b=$("<input type='text'/>");a.append(b);b.css({border:"#6E90BE"});var c={type:d.editor.type=="float"?"float":"int"};if(d.editor.minValue!=undefined){c.minValue=d.editor.minValue;}if(d.editor.maxValue!=undefined){c.maxValue=d.editor.maxValue;}b.ligerSpinner(c);return b;},getValue:function(a,d){var b=d.column;var c=b.editor.type=="int";if(c){return parseInt(a.val(),10);}else{return parseFloat(a.val());}},setValue:function(a,b,c){a.val(b);},resize:function(b,c,a,d){b.liger("option","width",c);b.liger("option","height",a);},destroy:function(a,b){a.liger("destroy");}};$.ligerDefaults.Grid.editors["string"]=$.ligerDefaults.Grid.editors["text"]={create:function(a,c){var b=$("<input type='text' class='l-text-editing'/>");if(typeof(c.column.validate)=="string"){b.attr("validate",c.column.validate);}else{if(c.column.validate&&typeof(c.column.validate)=="object"){b.attr("validate",JSON2.stringify(c.column.validate));}}if(c.grid){var d=c.grid.id+"_editor_"+c.grid.editorcounter+++"_"+new Date().getTime();b.attr("name",d).attr("id",d);}a.append(b);b.ligerTextBox();return b;},getValue:function(a,b){return a.val();},setValue:function(a,b,c){a.val(b);},resize:function(b,c,a,d){b.liger("option","width",c-2);b.liger("option","height",19);},destroy:function(a,b){a.liger("destroy");}};$.ligerui.controls.Grid.prototype.showFilter=function(){var h=this,b=this.options;if(h.winfilter){h.winfilter.show();return;}var a=$('<div id="'+h.id+'_filtercontainer"></div>').width(380).height(120).hide();var i=[];$(h.columns).each(function(){var q={name:this.name,display:this.display};var g=this.type=="int"||this.type=="number"||this.type=="float";var p=this.type=="date";if(g){q.type="number";}if(p){q.type="date";}if(this.editor){q.editor=this.editor;}i.push(q);});var c=a.ligerFilter({fields:i});h.winfilter=$.ligerDialog.open({width:420,height:208,target:a,isResize:true,top:50,buttons:[{text:"确定",onclick:function(o,g){d();g.hide();}},{text:"取消",onclick:function(o,g){g.hide();}}]});var m=$('<div class="historypanle"><select class="selhistory"><option value="0">历史查询记录</options></select><input type="button" value="删除" class="deletehistory" /><input type="button" value="保存" class="savehistory" /></div>');a.append(m);var k=$(".selhistory",m).change(function(){if(this.value=="0"){return;}var g=j(this.value);if(g){c.setData(g);}});$(".deletehistory",m).click(function(){if(k.val()=="0"){return;}$.ligerDialog.confirm("确定删除吗",function(g){if(g){n(k.val());l();}});});$(".savehistory",m).click(function(){$.ligerDialog.prompt("输入保存名字",JSON2.stringify(new Date()).replace(/["-\.:]/g,""),false,function(o,g){if(o&&g){e(g);l();k.val(g);}});});l();function f(){return encodeURIComponent(b.url.replace(/(.+)?view=/,""));}function l(){k.html('<option value="0">历史查询记录</options>');var g=f();var p=BIONE.cookies.get(g);if(p){var o=JSON2.parse(p);$(o).each(function(){k.append('<option value="'+this.name+'">'+this.name+"</options>");});}}function n(o){var q=f();var r;var s=BIONE.cookies.get(q);if(s){r=JSON2.parse(s);for(var p=0,g=r.length;p<g;p++){if(r[p].name==o){r.splice(p,1);BIONE.cookies.set(q,JSON2.stringify(r));return;}}}}function e(g){var o=f();var p;var q=BIONE.cookies.get(o);if(q){p=JSON2.parse(q);p.push({name:g,value:c.getData()});}else{p=[{name:g,value:c.getData()}];}BIONE.cookies.set(o,JSON2.stringify(p));}function j(o){var q=f();var s=BIONE.cookies.get(q);if(s){var r=JSON2.parse(s);for(var p=0,g=r.length;p<g;p++){if(r[p].name==o){return r[p].value;}}}return null;}function d(){var g=c.getData();if(g&&g.rules&&g.rules.length){h.set("parms",{where:JSON2.stringify(g)});}else{h.set("parms",{});}h.loadData();}};$.extend($.ligerui.controls.TextBox.prototype,{checkNotNull:function(){var a=this,b=this.options;if(b.nullText&&!b.disabled){if(!a.inputText.val()){a.inputText.addClass("l-text-field-null").val(b.nullText);}}}});$.extend($.ligerui.controls.ComboBox.prototype,{_setHeight:function(b){var a=this;if(b>10){a.wrapper.height(b);a.inputText.height(b);a.link.height(b);a.textwrapper.css({height:b});}}});$.ligerui.controls.DateEditor.prototype.updateStyle=function(){var b=this,c=this.options;var a=$.ligerDefaults.Grid.formatters["date"](b.inputText.val(),{format:c.format});b.inputText.val(a);};$.ligerui.controls.ComboBox.prototype.loadText=function(b){var c=this,e=this.options;b=$.extend({url:"../handler/select.ashx",view:null,idfield:null,textfield:null},b||{});var d=b.value||c.getValue();var a={op:"and",rules:[{field:b.idfield,op:"equal",value:d}]};$.ajax({cache:false,async:true,dataType:"json",type:"post",url:b.url,data:{view:b.view,idfield:b.idfield,textfield:b.textfield,where:JSON2.stringify(a)},success:function(f){if(!f||!f.length){return;}c._changeValue(f[0]["id"],f[0]["text"]);}});};$.ligerui.controls.ComboBox.prototype.openSelect=function(c){var d=this,e=this.options;d.bind("beforeOpen",function(){if(c.dialogType&&c.dialogType=="icon"){b();}else{a();}return false;});function b(){BIONE.commonOpenIconDialog(c.title,c.dialogname,c.url,c.comboxName);}function a(){BIONE.commonOpenDialog(c.title,c.dialogname,c.width,c.height,c.url,c.comboxName);}};